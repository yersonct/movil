<ion-header class="header ion-no-border" [translucent]="true">
  <ion-toolbar class="toolbar">
    <div class="greeting">
      <div class="profile-info">
        <!-- <div class="tiny">Mi Perfil</div> -->
        <div class="name">Mi perfil</div>
      </div>
    </div>

    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="refreshProfile()">
        <ion-icon name="refresh-outline"></ion-icon>
      </ion-button>

    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="dark">
  <div class="content-padder">

    <!-- Información del Usuario -->
    <div class="user-card">
      <div class="user-header">
        <div class="user-avatar" (click)="changeAvatar()">
          <img src="assets/images/avatar.png" [alt]="userProfile.name" />
          <div class="avatar-overlay">
            <ion-icon name="camera-outline"></ion-icon>
          </div>
        </div>

        <div class="user-info">
          <div class="user-name">{{ userProfile.name }}</div>
          <div class="user-email">{{ userProfile.email }}</div>
          <div class="user-member-since">Miembro desde {{ userProfile.memberSince | date:'MMM yyyy' }}</div>
        </div>

        <ion-button fill="clear" size="small" class="edit-profile-btn" (click)="changeAvatar()">
          <ion-icon name="settings-outline"></ion-icon>

        </ion-button>
      </div>

      <div class="user-stats">
        <div class="stat-item">
          <div class="stat-number">{{ userStats.totalVisits }}</div>
          <div class="stat-label">Visitas</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ userStats.totalHours }}</div>
          <div class="stat-label">Horas</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">${{ userStats.totalSpent | number:'1.0-0' }}</div>
          <div class="stat-label">Gastado</div>
        </div>
      </div>


    </div>

    <!-- Mis Vehículos -->
    <div class="vehicles-section">
      <div class="section-header">
        <div class="section-title">
          <div class="tiny muted">Mis Vehículos</div>
          <div class="section-count">{{ userVehicles.length }} registrados</div>
        </div>
        <ion-button size="small" fill="clear" (click)="addVehicle()">
          <ion-icon name="add-circle-outline"></ion-icon>
          Agregar
        </ion-button>
      </div>

      <div class="vehicles-list">
        <div class="vehicle-item" *ngFor="let vehicle of userVehicles" (click)="editVehicle(vehicle)">
          <div class="vehicle-image">
            <ion-img [src]="getVehicleImage(vehicle)" [alt]="vehicle.plate"></ion-img>
          </div>

          <div class="vehicle-details">
            <div class="vehicle-plate">{{ vehicle.plate }}</div>
            <div class="vehicle-info">
              <span class="vehicle-brand">{{ vehicle.brand }} {{ vehicle.model }}</span>
              <span class="vehicle-year">{{ vehicle.year }}</span>
            </div>
            <div class="vehicle-type">
              <ion-icon [name]="getVehicleTypeIcon(vehicle.type)"></ion-icon>
              <span>{{ getVehicleTypeName(vehicle.type) }}</span>
            </div>
          </div>

          <div class="vehicle-status">
            <div class="status-badge" [class.active]="vehicle.isActive">
              {{ vehicle.isActive ? 'Activo' : 'Inactivo' }}
            </div>
            <ion-button fill="clear" size="small" (click)="toggleVehicleMenu($event, vehicle)">
              <ion-icon name="ellipsis-vertical"></ion-icon>
            </ion-button>
          </div>
        </div>

        <div class="empty-vehicles" *ngIf="userVehicles.length === 0">
          <ion-icon name="car-outline"></ion-icon>
          <div class="empty-title">Sin vehículos registrados</div>
          <div class="empty-text">Agrega tu primer vehículo para comenzar</div>
          <ion-button (click)="addVehicle()">
            <ion-icon name="add" slot="start"></ion-icon>
            Agregar Vehículo
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Historial Reciente -->
    <div class="history-section">
      <div class="section-header">
        <div class="section-title">
          <div class="tiny muted">Historial Reciente</div>
        </div>
        <ion-button size="small" fill="clear" (click)="showFullHistory()">
          Ver todo
        </ion-button>
      </div>

      <div class="history-list">
        <div class="history-item" *ngFor="let entry of recentHistory">
          <div class="history-icon" [class]="entry.type">
            <ion-icon [name]="getHistoryIcon(entry.type)"></ion-icon>
          </div>

          <div class="history-details">
            <div class="history-title">{{ entry.title }}</div>
            <div class="history-subtitle">{{ entry.location }} • {{ entry.date | date:'short' }}</div>
            <div class="history-duration" *ngIf="entry.duration">
              Duración: {{ entry.duration }}
            </div>
          </div>

          <div class="history-cost" *ngIf="entry.cost">
            ${{ entry.cost | number:'1.0-0' }}
          </div>
        </div>

        <div class="empty-history" *ngIf="recentHistory.length === 0">
          <ion-icon name="time-outline"></ion-icon>
          <div class="empty-text">Sin historial reciente</div>
        </div>
      </div>
    </div>

    <!-- Métodos de Pago -->
    <div class="payment-section">
      <div class="section-header">
        <div class="section-title">
          <div class="tiny muted">Métodos de Pago</div>
        </div>
        <ion-button size="small" fill="clear" (click)="addPaymentMethod()">
          <ion-icon name="add-circle-outline"></ion-icon>
          Agregar
        </ion-button>
      </div>

      <div class="payment-list">
        <div class="payment-item" *ngFor="let payment of paymentMethods" [class.default]="payment.isDefault">
          <div class="payment-icon">
            <ion-icon [name]="getPaymentIcon(payment.type)"></ion-icon>
          </div>

          <div class="payment-details">
            <div class="payment-name">{{ payment.name }}</div>
            <div class="payment-info">{{ getPaymentInfo(payment) }}</div>
            <div class="payment-default" *ngIf="payment.isDefault">Método principal</div>
          </div>

          <ion-button fill="clear" size="small" (click)="editPaymentMethod(payment)">
            <ion-icon name="create-outline"></ion-icon>
          </ion-button>
        </div>

        <div class="empty-payments" *ngIf="paymentMethods.length === 0">
          <ion-icon name="card-outline"></ion-icon>
          <div class="empty-text">Sin métodos de pago</div>
          <ion-button fill="outline" size="small" (click)="addPaymentMethod()">
            Agregar método
          </ion-button>
        </div>
      </div>
    </div>

    <!-- Configuraciones Rápidas -->
    <div class="quick-settings">
      <div class="section-header">
        <div class="tiny muted">Configuración</div>
      </div>

      <div class="settings-list">
        <div class="setting-item" (click)="toggleNotifications()">
          <div class="setting-icon">
            <ion-icon name="notifications-outline"></ion-icon>
          </div>
          <div class="setting-details">
            <div class="setting-name">Notificaciones</div>
            <div class="setting-description">Alertas y recordatorios</div>
          </div>
          <ion-toggle [(ngModel)]="settings.notifications" color="success"></ion-toggle>
        </div>

        <div class="setting-item" (click)="toggleDarkMode()">
          <div class="setting-icon">
            <ion-icon name="moon-outline"></ion-icon>
          </div>
          <div class="setting-details">
            <div class="setting-name">Modo Oscuro</div>
            <div class="setting-description">Tema de la aplicación</div>
          </div>
          <ion-toggle [(ngModel)]="settings.darkMode" color="success"></ion-toggle>
        </div>

        <div class="setting-item" (click)="toggleAutoReserve()">
          <div class="setting-icon">
            <ion-icon name="time-outline"></ion-icon>
          </div>
          <div class="setting-details">
            <div class="setting-name">Reserva Automática</div>
            <div class="setting-description">Reservar lugares favoritos</div>
          </div>
          <ion-toggle [(ngModel)]="settings.autoReserve" color="success"></ion-toggle>
        </div>
      </div>
    </div>

    <!-- Acciones del Perfil -->
    <div class="profile-actions">
      <div class="action-group">
        <ion-button fill="clear" class="action-btn" (click)="showHelp()">
          <ion-icon name="help-circle-outline" slot="start"></ion-icon>
          Ayuda y Soporte
        </ion-button>

        <ion-button fill="clear" class="action-btn" (click)="showPrivacyPolicy()">
          <ion-icon name="shield-outline" slot="start"></ion-icon>
          Privacidad
        </ion-button>

        <ion-button fill="clear" class="action-btn" (click)="showTerms()">
          <ion-icon name="document-text-outline" slot="start"></ion-icon>
          Términos y Condiciones
        </ion-button>

        <ion-button fill="clear" class="action-btn" (click)="rateApp()">
          <ion-icon name="star-outline" slot="start"></ion-icon>
          Calificar App
        </ion-button>
      </div>

      <div class="logout-section">
        <ion-button
          expand="block"
          fill="outline"
          color="danger"
          class="logout-btn"
          (click)="logout()">
          <ion-icon name="log-out-outline" slot="start"></ion-icon>
          Cerrar Sesión
        </ion-button>
      </div>
    </div>

    <!-- Información de la App -->
    <div class="app-info">
      <div class="app-version">Versión {{ appVersion }}</div>
      <div class="app-copyright">© 2024 ParkingApp. Todos los derechos reservados.</div>
    </div>

  </div>
</ion-content>
