<ion-header class="header-animated">
  <ion-toolbar>
    <ion-title>Restablecer contraseña</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="close()">Cerrar</ion-button>
    </ion-buttons>
  </ion-toolbar>

  <div class="progress-bar">
    <div
      class="progress"
      [style.width]="step === 'email' ? '33%' : step === 'verify' ? '66%' : '100%'"
    ></div>
  </div>
</ion-header>

<!-- Mensaje centrado -->
<div
  class="inline-alert"
  *ngIf="showInlineAlert"
  [ngClass]="alertType"
  @fadeSlide
>
  <ion-icon
    [name]="alertType === 'success' ? 'checkmark-circle-outline' : 'alert-circle-outline'"
  ></ion-icon>
  <span>{{ alertMessage }}</span>
</div>

<ion-content class="ion-padding dark-content">

  <!-- Paso 1 -->
  <form *ngIf="step === 'email'" [formGroup]="form" @fadeSlide>
    <div class="icon-wrap"><ion-icon name="mail-outline"></ion-icon></div>
    <h2>Recuperar acceso</h2>
    <p>Ingresa tu correo electrónico y te enviaremos un código de verificación.</p>

    <ion-item lines="none">
      <ion-input
        formControlName="email"
        type="email"
        placeholder="Correo electrónico"
      ></ion-input>
    </ion-item>

    <ion-button expand="block" (click)="sendCode()" [disabled]="loading">
      {{ loading ? 'Enviando...' : 'Enviar código' }}
    </ion-button>
  </form>

  <!-- Paso 2 -->
  <form *ngIf="step === 'verify'" [formGroup]="form" @fadeSlide>
    <div class="icon-wrap"><ion-icon name="key-outline"></ion-icon></div>
    <h2>Verifica tu correo</h2>
    <p>Revisa tu bandeja de entrada e ingresa el código recibido.</p>

    <ion-item lines="none">
      <ion-input
        formControlName="code"
        type="text"
        inputmode="numeric"
        placeholder="Código de verificación"
      ></ion-input>
    </ion-item>

    <ion-button expand="block" (click)="verifyCode()" [disabled]="loading">
      {{ loading ? 'Verificando...' : 'Verificar código' }}
    </ion-button>
  </form>

  <!-- Paso 3 -->
  <form *ngIf="step === 'reset'" [formGroup]="form" @fadeSlide>
    <div class="icon-wrap"><ion-icon name="lock-closed-outline"></ion-icon></div>
    <h2>Nueva contraseña</h2>
    <p>Crea una nueva contraseña segura.</p>

    <ion-item lines="none" class="password-item">
      <ion-input
        formControlName="password"
        [type]="showPassword ? 'text' : 'password'"
        placeholder="Nueva contraseña"
      ></ion-input>
      <ion-icon
        slot="end"
        [name]="showPassword ? 'eye-outline' : 'eye-off-outline'"
        class="eye-icon"
        (click)="togglePassword()"
      ></ion-icon>
    </ion-item>

    <ion-button expand="block" (click)="resetPassword()" [disabled]="loading">
      {{ loading ? 'Guardando...' : 'Restablecer contraseña' }}
    </ion-button>
  </form>
</ion-content>
  